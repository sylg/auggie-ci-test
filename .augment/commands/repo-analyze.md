---
description: Analyze repository and generate optimized CI commands
argument-hint: [--output-dir path]
---

# Repository Analyzer

Analyze the current repository to understand its tech stack, testing patterns, and common failure modes. Output a configuration that can be used to generate optimized CI commands.

## Analysis Steps

### 1. Detect Tech Stack

Examine the repository to identify:

**Package Manager & Runtime:**
- Check for `package.json` (npm/yarn/pnpm)
- Check for `requirements.txt` / `pyproject.toml` (Python)
- Check for `go.mod` (Go)
- Check for `Cargo.toml` (Rust)

**Language & Framework:**
- TypeScript vs JavaScript (check `tsconfig.json`)
- React, Next.js, Vue, etc. (check dependencies)
- Express, Fastify, NestJS, etc. (check dependencies)

**Testing Framework:**
- Jest, Vitest, Mocha (JS/TS)
- pytest, unittest (Python)
- go test (Go)

**Linting & Formatting:**
- ESLint, Prettier, Biome
- pylint, ruff, black
- golangci-lint

**CI/CD:**
- GitHub Actions (`.github/workflows/`)
- GitLab CI (`.gitlab-ci.yml`)
- Other CI systems

### 2. Analyze Project Structure

Identify patterns:
- Where are tests located? (`__tests__/`, `*.test.ts`, `tests/`)
- Where is source code? (`src/`, `lib/`, `app/`)
- Are there E2E tests? (`e2e/`, `cypress/`, `playwright/`)
- Database/ORM used? (Prisma, TypeORM, Sequelize)

### 3. Identify Common Failure Patterns

Based on the tech stack, list likely failure types:

**TypeScript + Jest Project:**
```yaml
common_failures:
  - pattern: "TS2322: Type .* is not assignable"
    type: type_error
    risk: low
    auto_fix: true
  - pattern: "Cannot find module"
    type: import_error
    risk: low
    auto_fix: true
  - pattern: "Snapshot .* does not match"
    type: snapshot_mismatch
    risk: medium
    auto_fix: false
```

**Python + pytest Project:**
```yaml
common_failures:
  - pattern: "AssertionError"
    type: test_failure
    risk: medium
  - pattern: "ModuleNotFoundError"
    type: import_error
    risk: low
  - pattern: "TypeError: .* missing .* required"
    type: type_error
    risk: low
```

### 4. Output Configuration

Generate a YAML configuration file:

```yaml
# .augment/repo-config.yml
# Auto-generated by /repo-analyze

project:
  name: [detected from package.json or directory]
  type: [web-app|api|library|cli|monorepo]

tech_stack:
  language: typescript
  version: "5.x"
  runtime: node
  runtime_version: "20"
  framework: next.js
  framework_version: "14.x"

build:
  install: npm ci
  build: npm run build
  typecheck: npm run typecheck
  lint: npm run lint
  test: npm test
  test_coverage: npm run test:coverage

structure:
  source: src/
  tests: src/**/__tests__/
  e2e: e2e/
  config: ./

failure_patterns:
  type_error:
    patterns:
      - "TS\\d+:"
      - "Type .* is not assignable"
    risk: low
    verification: npm run typecheck

  lint_error:
    patterns:
      - "ESLint:"
      - "Parsing error:"
    risk: low
    verification: npm run lint

  test_failure:
    patterns:
      - "FAIL src/"
      - "Expected .* Received"
    risk: medium
    verification: npm test

  build_error:
    patterns:
      - "Build failed"
      - "Module not found"
    risk: medium
    verification: npm run build

ci_commands:
  verify_all: npm run typecheck && npm run lint && npm test && npm run build
  quick_check: npm run typecheck && npm run lint

conventions:
  commit_style: conventional  # or: none, angular, etc.
  branch_pattern: "feature/*|fix/*|chore/*"
```

### 5. Generate Custom Commands (Optional)

If `--generate-commands` flag is passed, create customized command files:

- `.augment/commands/ci-heal.md` - Customized with repo-specific patterns
- `.augment/commands/ci-analyze.md` - Customized error detection

## Usage

```bash
# Analyze repo and output config
auggie /repo-analyze

# Analyze and generate custom commands
auggie /repo-analyze --generate-commands

# Output to specific directory
auggie /repo-analyze --output-dir .augment/
```
